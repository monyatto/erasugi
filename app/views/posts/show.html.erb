<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/konva@9/konva.min.js"></script>

  <meta charset="utf-8" />
  <title>Konva Sprite Demo</title>
</head>
<body>
<div id="container" style="position: absolute; width: 100%; height: 100%;"></div>
<div class="font-sans text-center m-20" style="position: relative;">
  <div class="text-[60px] font-sans m-4 mb-10" style="position: relative;"><%= @post.content %></div>
  <div class="flex justify-center" style="position: relative;">
    <% @reactions_types.each do |reactions_type| %>
      <%= button_to "#{reactions_type.name}（#{@reactions_counts[reactions_type.id]}）", reactions_path(post_id: @post.id, reactions_type_id: reactions_type.id), {method: :post, class: "btn text-lg m-10 w-24 h-24 rounded-full drop-shadow-md bg-white"} %>
    <% end %>
  </div>
    <%= link_to "編集", edit_post_path(@post), class:"btn" %>
    <%= link_to "戻る", posts_path, class:"btn" %>
    <%= button_to "削除", @post, method: :delete, class: "btn-danger" %>
</div>

<script>
    window.onload = function() {
    const stage = new Konva.Stage({
        container: 'container',
        width: window.innerWidth,
        height: window.innerHeight
    });

    const layer = new Konva.Layer();
    stage.add(layer);

    const imageObj = new Image();
    imageObj.onload = function() {
        const sprite = new Konva.Sprite({
            x: 50,
            y: 50,
            image: imageObj,
            animation: 'idle',
            animations: {
                idle: [
                    // x, y, width, height (4 frames)
                    0, 0, 300, 300, 300, 0, 300, 300,
                ]
            },
            frameRate: 7,
            frameIndex: 0
        });

        layer.add(sprite);
        sprite.start();

        const button = document.createElement('button');
        button.innerText = 'Add Sprite';
        button.style.position = 'absolute';
        button.style.top = '10px';
        button.style.left = '10px';
        document.body.appendChild(button);

        button.addEventListener('click', () => {
            const newSprite = sprite.clone();
            newSprite.x(Math.random() * stage.width());
            newSprite.y(Math.random() * stage.height());
            layer.add(newSprite);
            newSprite.start();
        });
    };

    imageObj.src = '/assets/test.png';
    };
</script>
</body>
</html>
